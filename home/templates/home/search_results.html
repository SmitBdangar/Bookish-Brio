{% extends "home/base.html" %}

{% block title %}Search Results - Bookish Brio{% endblock %}

{% block content %}
<div
    style="background: white; border: 1px solid var(--border); border-radius: 4px; padding: 16px; margin-bottom: 16px;">
    <h2 style="font-size: 1.1rem; font-weight: 600;">Results for "{{ query }}"</h2>
    <p style="font-size: 0.85rem; color: var(--text-meta);">Found {{ page_obj.paginator.count }} results</p>
</div>

<div class="search-filters"
    style="display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 4px;">
    <a href="?q={{ query }}&type=all" class="btn-orange {% if search_type == 'all' %}active{% endif %}"
        style="background: {% if search_type == 'all' %}var(--primary){% else %}#f6f7f8{% endif %}; color: {% if search_type == 'all' %}white{% else %}var(--text-meta){% endif %}; padding: 6px 16px; font-size: 0.8rem;">All</a>
    <a href="?q={{ query }}&type=posts" class="btn-orange"
        style="background: {% if search_type == 'posts' %}var(--primary){% else %}#f6f7f8{% endif %}; color: {% if search_type == 'posts' %}white{% else %}var(--text-meta){% endif %}; padding: 6px 16px; font-size: 0.8rem;">Posts</a>
    <a href="?q={{ query }}&type=tags" class="btn-orange"
        style="background: {% if search_type == 'tags' %}var(--primary){% else %}#f6f7f8{% endif %}; color: {% if search_type == 'tags' %}white{% else %}var(--text-meta){% endif %}; padding: 6px 16px; font-size: 0.8rem;">Tags</a>
    <a href="?q={{ query }}&type=authors" class="btn-orange"
        style="background: {% if search_type == 'authors' %}var(--primary){% else %}#f6f7f8{% endif %}; color: {% if search_type == 'authors' %}white{% else %}var(--text-meta){% endif %}; padding: 6px 16px; font-size: 0.8rem;">Authors</a>
</div>

<section class="results-feed">
    {% for post in page_obj %}
    <article class="post-card" onclick="window.location.href='{% url 'post_detail' post.pk %}'">
        <div class="post-main">
            <div class="post-meta">
                <a href="{% url 'public_profile' post.author.username %}" class="post-author"
                    onclick="event.stopPropagation();">
                    u/{{ post.author.username }}
                </a>
                <span>â€¢</span>
                <span>{{ post.created_at|timesince }} ago</span>
            </div>
            <h2 class="post-title">{{ post.title }}</h2>
            <div class="post-content-preview"
                style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; font-size: 0.9rem; color: #4a4a4a;">
                {{ post.preview_content }}
            </div>
            <div class="post-actions" style="margin-top: 12px; padding-left: 0;">
                <div class="action-btn">
                    <i class="far fa-heart"></i>
                    <span>{{ post.total_likes }}</span>
                </div>
            </div>
        </div>
    </article>
    {% empty %}
    <div
        style="background: white; padding: 60px; text-align: center; border-radius: 4px; border: 1px solid var(--border);">
        <i class="fas fa-search fa-3x" style="margin-bottom: 16px; opacity: 0.1;"></i>
        <h3 style="font-size: 1.1rem; margin-bottom: 8px;">No results found</h3>
        <p style="font-size: 0.9rem; color: var(--text-meta);">Try adjusting your search or filters.</p>
    </div>
    {% endfor %}
</section>

{% if page_obj.has_other_pages %}
<div class="pagination" style="display: flex; justify-content: center; gap: 8px; margin-top: 24px;">
    {% if page_obj.has_previous %}
    <a href="?q={{ query }}&type={{ search_type }}&page={{ page_obj.previous_page_number }}" class="btn-orange"
        style="background: #f6f7f8; color: var(--text-main); font-size: 0.85rem;">Previous</a>
    {% endif %}
    <span
        style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 4px; font-size: 0.85rem;">Page
        {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
    <a href="?q={{ query }}&type={{ search_type }}&page={{ page_obj.next_page_number }}" class="btn-orange"
        style="background: #f6f7f8; color: var(--text-main); font-size: 0.85rem;">Next</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}